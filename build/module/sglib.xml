<?xml version="1.0" encoding="UTF-8"?>
<build path="../.." default="sglib">
  <module type="config-header">
    <key name="target"><path path="include/config.h"/></key>
  </module>

  <module type="version-info">
    <key name="target"><path path="sg/core/version_const.c"/></key>
  </module>

  <module id="sglib">
    <require module="keycode libpce glew" public="true"/>
    <header-path path="include" public="true"/>

    <group path="include/sg">
      <src path="audio_mixdown.h"/>
      <src path="audio_ofile.h"/>
      <src path="audio_pcm.h"/>
      <src path="audio_sample.h"/>
      <src path="audio_source.h"/>
      <src path="audio_system.h"/>
      <src path="clock.h"/>
      <src path="configfile.h"/>
      <src path="cvar.h"/>
      <src path="defs.h"/>
      <src path="dispatch.h"/>
      <src path="entry.h"/>
      <src path="error.h"/>
      <src path="event.h"/>
      <src path="file.h"/>
      <src path="log.h"/>
      <src path="model.h"/>
      <src path="net.h"/>
      <src path="opengl.h"/>
      <src path="pixbuf.h"/>
      <src path="rand.h"/>
      <src path="record.h"/>
      <src path="texture.h"/>
      <src path="type.h"/>
      <src path="version.h"/>
    </group>

    <src path="include/config.h"/>

    <group path="sg/audio">
      <src path="convert.c"/>
      <src path="load.c"/>
      <src path="mixdown.c"/>
      <src path="ofile.c"/>
      <src path="pcm.c"/>
      <src path="resample.c"/>
      <src path="sample.c"/>
      <src path="source.c"/>
      <src path="sysprivate.h"/>
      <src path="system.c"/>
      <src path="wav.c"/>

      <group>
	<switch value="$flag.audio">
	  <case value="alsa">
	    <require module="alsa"/>
	    <src path="alsa.c"/>
	  </case>
	  <case value="coreaudio">
	    <require module="osx#CoreAudio osx#AudioUnit"/>
	    <src path="coreaudio.c"/>
	  </case>
	  <case value="directsound">
	    <src path="directsound8.c"/>
	  </case>
	</switch>
      </group>
    </group>

    <group path="sg/core">
      <src path="clock.c"/>
      <src path="clock_impl.h"/>
      <src path="configfile.c"/>
      <src path="configfile_read.c"/>
      <src path="cvar.c"/>
      <src path="error.c"/>
      <src path="model.c"/>
      <src path="net.c"/>
      <src path="opengl.c"/>
      <src path="rand.c"/>
      <src path="sys.c"/>
      <src path="texture.c"/>
      <src path="version.c"/>
      <src path="version_const.c"/>
    </group>

    <group path="sg/dispatch">
      <src path="sync.c"/>
    </group>

    <group path="sg/file">
      <src path="impl.h"/>
      <src path="norm.c"/>
      <src path="path.c"/>
      <src path="read.c"/>

      <switch value="$os">
	<case value="linux|osx">
	  <src path="posix.c"/>
	</case>
	<case value="windows">
	  <src path="win.c"/>
	</case>
      </switch>
    </group>

    <group path="sg/log">
      <src path="console.c"/>
      <src path="impl.h"/>
      <src path="log.c"/>
      <src path="network.c"/>
    </group>

    <group path="sg/pixbuf">
      <group>
	<switch value="$flag.jpeg">
	  <case value="coregraphics">
	    <require module="osx#ApplicationServices"/>
	    <src path="coregraphics.c"/>
	  </case>
	  <case value="libjpeg">
	    <require module="libjpeg"/>
	    <src path="libjpeg.c"/>
	  </case>
	  <case value="wincodec">
	    <src path="wincodec.cpp"/>
	  </case>
	</switch>
      </group>

      <group>
	<switch value="$flag.png">
	  <case value="coregraphics">
	    <require module="osx#ApplicationServices"/>
	    <src path="coregraphics.c"/>
	  </case>
	  <case value="libpng">
	    <require module="libpng"/>
	    <src path="libpng.c"/>
	  </case>
	  <case value="wincodec">
	    <src path="wincodec.cpp"/>
	  </case>
	</switch>
      </group>

      <src path="loadimage.c"/>
      <src path="pixbuf.c"/>
      <src path="premultiply_alpha.c"/>
    </group>

    <group path="sg/record">
      <src path="record.c"/>
      <src path="shot.c"/>
      <if value="$flag.video-recording == yes">
	<src path="vidproc.c"/>
	<src path="yuv.c"/>
      </if>
    </group>

    <group path="sg/type">
      <group>
	<switch value="$flag.type">
	  <case value="coretext">
	    <require module="osx#ApplicationServices"/>
	    <src path="coretext.c"/>
	  </case>
	  <case value="pango">
	    <require module="pango"/>
	    <src path="pango.c"/>
	  </case>
	  <case value="uniscribe">
	    <src path="uniscribe.c"/>
	  </case>
	</switch>
      </group>
      <src path="impl.h"/>
      <src path="type.c"/>
    </group>

    <group path="sg/work">
      <src path="aio.c"/>
      <src path="dispatch.c"/>
      <src path="work.h"/>
      <switch value="$os">
	<case value="linux|osx">
	  <src path="pthread.c"/>
	</case>
	<case value="windows">
	  <src path="windows.c"/>
	</case>
      </switch>
    </group>
  </module>
</build>
