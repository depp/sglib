<?xml version="1.0" encoding="UTF-8"?>
<build path="../.." default="sglib">
  <module type="config-header">
    <key name="target"><path path="include/config.h"/></key>
  </module>

  <module type="version-info">
    <key name="target"><path path="src/core/version_const.c"/></key>

    <key name="repo.SG_SG"><path path="."/></key>
    <key name="repo.SG_APP"><path path="/"/></key>
  </module>

  <module id="sglib">
    <require module="glew" public="true"/>
    <header-path path="include" public="true"/>

    <src path="private.h"/>

    <group path="include/sg">
      <src path="arch.h"/>
      <src path="atomic.h"/>
      <src path="attribute.h"/>
      <src path="audio_buffer.h"/>
      <src path="audio_file.h"/>
      <src path="audio_stream.h"/>
      <src path="binary.h"/>
      <src path="byteorder.h"/>
      <src path="clock.h"/>
      <src path="configfile.h"/>
      <src path="cpu.h"/>
      <src path="cvar.h"/>
      <src path="defs.h"/>
      <src path="entry.h"/>
      <src path="error.h"/>
      <src path="event.h"/>
      <src path="file.h"/>
      <src path="hash.h"/>
      <src path="hashtable.h"/>
      <src path="key.h"/>
      <src path="keycode.h"/>
      <src path="log.h"/>
      <src path="mixer.h"/>
      <src path="net.h"/>
      <src path="opengl.h"/>
      <src path="pixbuf.h"/>
      <src path="rand.h"/>
      <src path="strbuf.h"/>
      <src path="thread.h"/>
      <src path="type.h"/>
      <src path="util.h"/>
      <src path="version.h"/>
    </group>

    <src path="include/config.h"/>

    <group path="src/audio">
      <src path="buffer.c"/>
      <src path="convert.c"/>
      <src path="file.c"/>
      <src path="resample.c"/>
      <src path="wav.c"/>
      <src path="writer.c"/>

      <if value="$flag.ogg == yes">
        <group>
          <require module="ogg"/>
          <src path="ogg.c"/>
          <src path="ogg.h"/>
        </group>
        <if value="$flag.vorbis == yes">
          <group>
            <require module="ogg vorbis"/>
            <src path="vorbis.c"/>
          </group>
        </if>
        <if value="$flag.opus == yes">
          <group>
            <require module="ogg opus"/>
            <src path="opus.c"/>
          </group>
        </if>
      </if>
    </group>

    <group path="src/core">
      <src path="clock.c"/>
      <src path="clock_impl.h"/>
      <src path="configfile.c"/>
      <src path="cvar.c"/>
      <src path="error.c"/>
      <src path="file_impl.h"/>
      <src path="file_read.c"/>
      <src path="keyid.c"/>
      <src path="log.c"/>
      <!-- <src path="logtest.c"/> -->
      <src path="log_console.c"/>
      <src path="log_impl.h"/>
      <src path="log_network.c"/>
      <src path="net.c"/>
      <src path="opengl.c"/>
      <src path="path.c"/>
      <src path="path_norm.c"/>
      <src path="private.h"/>
      <src path="rand.c"/>
      <src path="sys.c"/>
      <src path="version.c"/>
      <src path="version_const.c"/>

      <switch value="$os">
        <case value="linux|osx">
          <src path="file_posix.c"/>
        </case>
        <case value="windows">
          <src path="winutf8.c"/>
          <src path="file_win.c"/>
        </case>
      </switch>

      <switch value="$os">
        <case value="linux">
          <src path="keytable_evdev.c"/>
        </case>
        <case value="osx">
          <src path="keytable_mac.c"/>
        </case>
        <case value="windows">
          <src path="keytable_win.c"/>
        </case>
      </switch>
    </group>

    <group path="src/mixer">
      <src path="channel.c"/>
      <src path="mixdown.c"/>
      <src path="mixer.c"/>
      <src path="mixer.h"/>
      <src path="queue.c"/>
      <src path="sound.c"/>
      <src path="sound.h"/>
      <src path="time.c"/>
      <src path="time.h"/>
      <src path="timeexact.c"/>

      <group>
        <switch value="$flag.audio">
          <case value="alsa">
            <require module="alsa"/>
            <src path="system_alsa.c"/>
          </case>
          <case value="coreaudio">
            <require module="osx#CoreAudio osx#AudioUnit"/>
            <src path="system_coreaudio.c"/>
          </case>
          <case value="directsound">
            <src path="system_directsound8.c"/>
          </case>
          <case value="sdl">
            <require module="sdl"/>
            <src path="system_sdl.c"/>
          </case>
        </switch>
      </group>

    </group>

    <group path="src/pixbuf">
      <group>
        <switch value="$flag.jpeg">
          <case value="coregraphics">
            <require module="osx#ApplicationServices"/>
            <src path="coregraphics.c"/>
          </case>
          <case value="libjpeg">
            <require module="libjpeg"/>
            <src path="libjpeg.c"/>
          </case>
          <case value="wincodec">
            <src path="wincodec.cpp"/>
          </case>
        </switch>
      </group>

      <group>
        <switch value="$flag.png">
          <case value="coregraphics">
            <require module="osx#ApplicationServices"/>
            <src path="coregraphics.c"/>
          </case>
          <case value="libpng">
            <require module="libpng"/>
            <src path="libpng.c"/>
          </case>
          <case value="wincodec">
            <src path="wincodec.cpp"/>
          </case>
        </switch>
      </group>

      <src path="loadimage.c"/>
      <src path="pixbuf.c"/>
      <src path="premultiply_alpha.c"/>
    </group>

    <group path="src/type">
      <group>
        <switch value="$flag.type">
          <case value="coretext">
            <require module="osx#ApplicationServices"/>
            <src path="coretext.c"/>
          </case>
          <case value="pango">
            <require module="pango"/>
            <src path="pango.c"/>
          </case>
          <case value="uniscribe">
            <src path="uniscribe.c"/>
          </case>
        </switch>
      </group>
    </group>

    <group path="src/util">
      <src path="cpu.c"/>
      <src path="hash.c"/>
      <src path="hashtable.c"/>
      <src path="strbuf.c"/>
      <switch value="$os">
        <case value="linux|osx">
          <src path="thread_pthread.c"/>
        </case>
        <case value="windows">
          <src path="thread_windows.c"/>
        </case>
      </switch>
    </group>
  </module>
</build>
